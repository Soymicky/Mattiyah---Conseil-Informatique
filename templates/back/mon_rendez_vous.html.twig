{% extends 'base.html.twig' %}

{% block title %}Mon Rendez-vous{% endblock %}

{% block body %}
<h1>Mon rendez-vous</h1>
<div class="container my-5">
    <h1 class="text-center fw-bold">
        Mon rendez-vous <span class="border-bottom border-warning d-inline-block" style="width: 60px;"></span>
    </h1>

    <h4 class="mt-5 fw-semibold">Prochain rendez-vous</h4>

    <div class="row align-items-start mt-4">
        <div class="col-md-8">
            <div class="mb-3 d-flex align-items-start">
                <i class="bi bi-person-circle fs-3 me-2"></i>
                <div>
                    {% if rendezvous %}
                        <p class="mb-1"><strong>De :</strong> {{ app.user.nom }} {{ app.user.prenom }}</p>
                        <p class="mb-1 text-danger"><strong>Date et heure :</strong> {{ rendezvous.dateRDV|date('d/m/Y H:i') }}</p>
                        <p class="mb-1"><strong>Service choisi :</strong> {{ rendezvous.service ? rendezvous.service.nomService : 'Non défini' }}</p>
                        <p class="mb-1"><strong>Type de service :</strong> {{ rendezvous.service ? rendezvous.service.typeService : 'Non défini' }}</p>
                    {% else %}
                        <p class="mb-1"><strong>De :</strong> {{ app.user.nom }} {{ app.user.prenom }}</p>
                        <p>Aucun rendez-vous pris.</p>
                        <p>Aucun service choisi</p>
                    {% endif %}
                </div>
            </div>

            <div class="d-flex gap-3">
                {% if rendezvous %}
                    <button class="btn btn-warning text-dark fw-semibold" data-bs-toggle="modal" data-bs-target="#editModal">
                        Modifier mon rendez-vous
                    </button>
                {% endif %}
                <button class="btn btn-light text-danger fw-semibold border border-danger" data-bs-toggle="modal" data-bs-target="#cancelModal">
                    Je souhaite annuler mon rendez-vous
                </button>
            </div>
        </div>

        <div class="col-md-4">
            <div class="bg-light rounded" style="width: 100%; height: 180px;"></div>
        </div>
    </div>
</div>

{# MODAL DE CHANGEMENT DE RENDEZ-VOUS #}

<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header fondvert textjaune fw-bold">
                <h5 class="modal-title" id="editModalLabel">Modifier votre rendez-vous</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if rendezvous %}
                    <p>Votre rendez-vous actuel est prévu pour le : <strong class="texterouge">{{ rendezvous.dateRDV|date('d/m/Y H:i') }}</strong></p>
                    <form method="post" action="{{ path('modifier_mon_rendezvous', {'id': rendezvous.id}) }}">
                        <div class="mb-3 text-center">
                            <label for="nouveau-calendrier-jours" class="form-label texttresgras textvert texte_majuscule fs-2">Nouvelle date :</label>
                            <div class="d-flex justify-content-center align-items-center">
                                <button type="button" id="nouveau-mois-precedent" class="btn btn-outline-success me-2">&lt;</button>
                                <span id="nouveau-mois-en-cours" class="fw-semibold me-2 fs-3"></span>
                                <button type="button" id="nouveau-mois-suivant" class="btn btn-outline-success">&gt;</button>
                            </div>
                            <div class="mt-2">
                                <select id="nouveau-annee" class="form-select form-select-sm w-auto mx-auto"></select>
                            </div>
                            <div id="nouveau-calendrier-jours" class="d-grid gap-2 mt-2" style="grid-template-columns: repeat(7, 1fr);">
                            </div>
                            <input type="hidden" id="nouvelle-input-date" name="nouvelle_date" value="{{ rendezvous.dateRDV ? rendezvous.dateRDV|date('Y-m-d') }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="nouvelle_heure" class="form-label fw-semibold">Nouvelle heure :</label>
                            <select class="form-select" id="nouvelle_heure" name="nouvelle_heure" required>
                                <option value="{{ rendezvous.dateRDV ? rendezvous.dateRDV|date('H:i') }}">Heure actuelle : {{ rendezvous.dateRDV ? rendezvous.dateRDV|date('H:i') }}</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="service" class="form-label fw-semibold">Nouveau service :</label>
                            <select id="service" name="service" class="form-select">
                                <option value="{{ rendezvous.service ? rendezvous.service.nomService }}">Service actuel : {{ rendezvous.service ? rendezvous.service.nomService : 'Non défini' }}</option>
                                {% for service in services %}
                                    <option value="{{ service.nomService }}">{{ service.nomService }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="typeService" class="form-label fw-semibold">Nouveau type de service :</label>
                            <select id="typeService" name="typeService" class="form-select">
                                <option value="{{ rendezvous.service ? rendezvous.service.typeService }}">Type actuel : {{ rendezvous.service ? rendezvous.service.typeService : 'Non défini' }}</option>
                                {% for type in typesOffre %}
                                    <option value="{{ type.typeService }}">{{ type.typeService }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="justification" class="form-label fw-semibold">Motif du déplacement (facultatif) :</label>
                            <select class="form-select" id="justification" name="justification">
                                <option value="">-- Choisissez un motif --</option>
                                <option value="erreur_date">Erreur de date</option>
                                <option value="changement_emploi_du_temps">Changement d'emploi du temps</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="commentaire" class="form-label fw-semibold">Commentaire (facultatif) :</label>
                            <textarea class="form-control" id="commentaire" name="commentaire" rows="3"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-warning text-dark fw-semibold">Mettre à jour le rendez-vous</button>
                        </div>
                    </form>
                {% else %}
                    <p>Aucun rendez-vous à modifier.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{#  ICI ON ANNULE LE RENDEZ VOUS #}

<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content padding20">
            <div class="modal-header ">
                <h5 class="modal-title texte_majuscule" id="cancelModalLabel">Annulation rendez-vous</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="fs-5 fw-bold texterouge text-center">Vous êtes sur le point annuler votre rendez-vous</p>
                <p class="fs-6">Afin de mieux comprendre votre décision, pourriez-vous s'il vous plaît indiquer les raisons de l'annulation ??</p>
                </div>
             <div class="mb-3">
                            <label for="justification" class="form-label fw-semibold">Motif du déplacement (facultatif) :</label>
                            <select class="form-select" id="justification" name="justification">
                                <option value="">-- Choisissez un motif --</option>
                                <option value="erreur_date">Erreur de date</option>
                                <option value="changement_emploi_du_temps">Changement d'emploi du temps</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="commentaire" class="form-label fw-semibold">Commentaire (facultatif) :</label>
                            <textarea class="form-control" id="commentaire" name="commentaire" rows="3"></textarea>
                        </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Non, annuler</button>
                {% if rendezvous %}
                    <a href="{{ path('annulerRDV', {'id': rendezvous.id}) }}" class="btn fondrouge text-white fw-semibold">Oui, annuler mon rendez-vous</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/mon-rdv.js') }}"></script>
{% endblock %}